<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ibm.issue.dao.UserAndIdentityMapper">
	<resultMap id="UserAndIdentity"
		type="com.ibm.issue.pojo.User">
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="userId" jdbcType="VARCHAR" property="userid" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="email" jdbcType="VARCHAR" property="email" />
		<result column="password" jdbcType="VARCHAR"
			property="password" />
		<result column="signUp" jdbcType="DATE" property="signup" />
		<result column="permission" jdbcType="INTEGER"
			property="permission" />
		<result column="userState" jdbcType="CHAR" property="userstate" />
		<association property="identity"
			javaType="com.ibm.issue.pojo.Identity">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="pid" property="pid" jdbcType="INTEGER" />
			<result column="position" property="position"
				jdbcType="VARCHAR" />
		</association>
	</resultMap>
	<resultMap id="ReportAndState"
		type="com.ibm.issue.pojo.Report">
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="issueId" jdbcType="VARCHAR" property="issueid" />
		<result column="title" jdbcType="VARCHAR" property="title" />
		<result column="type" jdbcType="VARCHAR" property="type" />
		<result column="level" jdbcType="CHAR" property="level" />
		<result column="version" jdbcType="VARCHAR" property="version" />
		<result column="creator" jdbcType="VARCHAR" property="creator" />
		<result column="createDate" jdbcType="DATE"
			property="createdate" />
		<result column="modifier" jdbcType="VARCHAR"
			property="modifier" />
		<result column="state" jdbcType="INTEGER" property="state" />
		<result column="planDate" jdbcType="DATE" property="plandate" />
		<result column="endDate" jdbcType="DATE" property="enddate" />
		<association property="issuestate"
			javaType="com.ibm.issue.pojo.Issuestate">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="sid" property="sid" jdbcType="INTEGER" />
			<result column="detail" property="detail" jdbcType="VARCHAR" />
		</association>
	</resultMap>
	
	
	<select id="findUserAndIdentity" resultMap="UserAndIdentity">
		select
		user.userId,user.name,user.email,user.password,user.signUp,user.userState,identity.position
		from user,identity
		where user.permission = identity.pid
		<if test="user != null">
			<if test="user.userid != null">
				AND user.userId like concat('%', #{user.userid}, '%')
			</if>
		</if>
		<if test="user != null">
			<if test="user.name != null">
				AND user.name like concat('%', #{user.name}, '%')
			</if>
		</if>
	</select>
	
	
	<select id="findReportAndState" resultMap="ReportAndState">
		select
		r.issueId,r.title,r.creator,r.createDate,r.modifier,i.detail,r.planDate,r.endDate
		from report r,issuestate i
		where r.state = i.sid
		<if test="issueid != null">
			AND issueId like concat('%', #{issueid}, '%')
		</if>
		<if test="state != null">
			AND state like concat('%', #{state}, '%')
		</if>
		<if test="creator != null">
			AND creator like concat('%', #{creator}, '%')
		</if>
		<if test="modifier != null">
			AND modifier like concat('%', #{modifier}, '%')
		</if>
		<if test="createStartDate != null  ">
			AND createdate between #{createStartDate} and #{createEndDate}
		</if>
		<if test="endStartDate != null">
			AND enddate between #{endStartDate} and #{endEndDate}
		</if>
		
		
	</select>
</mapper>